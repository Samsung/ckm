PKG_CHECK_MODULES(KEY_MANAGER_TEST_DEP
    dlog
    openssl
    REQUIRED
    )

ADD_DEFINITIONS( "-DBOOST_TEST_DYN_LINK" )

SET(KEY_MANAGER_SRC_PATH ${PROJECT_SOURCE_DIR}/src)
SET(KEY_MANAGER_PATH ${PROJECT_SOURCE_DIR}/src/manager)

################################################################################


SET(KEY_MANAGER_TEST_MERGED_SRC ${PROJECT_SOURCE_DIR}/tests)

INCLUDE_DIRECTORIES(
    ${KEY_MANAGER_PATH}/dpl/db/include
    ${KEY_MANAGER_PATH}/dpl/core/include
    ${KEY_MANAGER_PATH}/dpl/log/include
    ${KEY_MANAGER_PATH}/sqlcipher
    ${KEY_MANAGER_PATH}/service
    ${KEY_MANAGER_PATH}/common/
    ${KEY_MANAGER_SRC_PATH}/include
    ${KEY_MANAGER_TEST_MERGED_SRC}/
    )

SET(TEST_MERGED_SOURCES
    ${KEY_MANAGER_TEST_MERGED_SRC}/test_common.cpp
    ${KEY_MANAGER_TEST_MERGED_SRC}/colour_log_formatter.cpp
    ${KEY_MANAGER_TEST_MERGED_SRC}/test_db_crypto.cpp
    ${KEY_MANAGER_TEST_MERGED_SRC}/test_sql.cpp
    ${KEY_MANAGER_TEST_MERGED_SRC}/test-key-provider.cpp
    ${KEY_MANAGER_TEST_MERGED_SRC}/test_safe-buffer.cpp
    ${KEY_MANAGER_PATH}/service/db-crypto.cpp
    ${KEY_MANAGER_PATH}/service/key-provider.cpp

    )

ADD_EXECUTABLE(${TARGET_TEST_MERGED} ${TEST_MERGED_SOURCES})

TARGET_LINK_LIBRARIES(${TARGET_TEST_MERGED}
    ${KEY_MANAGER_CLIENT_DEP_LIBRARIES}
    ${KEY_MANAGER_DEP_LIBRARIES}
    ${TARGET_KEY_MANAGER_CLIENT}
    ${TARGET_KEY_MANAGER_COMMON}
    ${TARGET_KEY_MANAGER_KEY_PROVIDER}
    boost_unit_test_framework
    )

INSTALL(TARGETS ${TARGET_TEST_MERGED} DESTINATION bin)
